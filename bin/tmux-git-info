#!/usr/bin/env bash

main() {
  declare -a git_fields

  git_dir="$(git -C "$1" rev-parse --path-format=absolute --git-dir 2>/dev/null)"

  if ! [[ -d "$git_dir" ]]; then
    exit 1
  fi

  mapfile -t git_fields < <(git \
    --git-dir="$git_dir" \
    --no-pager \
    for-each-ref \
    --count=1 \
    --points-at=HEAD \
    --format="\
%(objectname:short)
%(committerdate:relative)
%(if)%(upstream)%(then)\
%(push:track)
%(upstream:short)
%(end)
    "
  )

  ahead="${git_fields[2]}"

  for i in {0..3}; do
    echo ${git_fields[$i]}
  done

}

main "$1"
