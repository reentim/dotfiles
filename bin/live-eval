#!/usr/bin/env bash
set -euo pipefail

# Only eval if the pipeline ends in something safe, like jq

# Use a unique temporary socket
TMUX_SOCKET=$(mktemp -u /tmp/live-eval-XXXXXX.sock)
SESSION_NAME="liveeval"

# Launch Kitty and run tmux inside
kitty --detach --start-as=normal bash -c "
	tmux -S $TMUX_SOCKET new-session -d -s $SESSION_NAME -n eval
	tmux -S $TMUX_SOCKET send-keys -t $SESSION_NAME 'zsh' C-m

	# Split into two panes (horizontal or vertical as preferred)
	tmux -S $TMUX_SOCKET split-window -h -t $SESSION_NAME

	# Placeholder for follower - currently tailing a dummy file
	tmux -S $TMUX_SOCKET send-keys -t $SESSION_NAME:0.1 'tail -f /tmp/live-eval-output.log' C-m

	# Attach to the session
	tmux -S $TMUX_SOCKET attach-session -t $SESSION_NAME
"
