#!/usr/bin/env ruby

FILE = "#{ENV['HOME']}/iCloud-Drive/cubes.csv"

# https://blog.dnsimple.com/2018/03/elapsed-time-with-ruby-the-right-way/

def main
  start = Process.clock_gettime(Process::CLOCK_MONOTONIC)

  await_keypress

  stop = Process.clock_gettime(Process::CLOCK_MONOTONIC)

  date_time = %Q[#{Time.now}, #{stop - start}\n]

  puts date_time
  puts "\nPress <ENTER> to save"

  await_keypress

  File.open(FILE, 'a') do |file|
    file.write(date_time)
  end

  puts "PB:", File.readlines(FILE).map { |line|
    line.split(', ')
      .reverse
      .map { |column| column.include?("\n") ? column.chomp.to_f : column }
  }.min
end

def await_keypress
  begin
    gets
  rescue Interrupt
    abort
  end
end

main
