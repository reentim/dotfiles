#!/usr/bin/env zsh
# must be zsh as zshenv uses zsh's built-in path array

# Attach to an existing detached session.
# If none exist, create a new session.

main() {
  local session="$(unattached_session)"

  # if [ -f "$HOME/.zshenv" ]; then
  #   source "$HOME/.zshenv"
  # fi

  if [[ -n "$session" ]]; then
      tmux attach-session -t "$session"
  else
      tmux new-session
  fi
}

unattached_session() {
  tmux list-sessions -F '#{session_name}:#{session_attached}' 2>/dev/null \
    | awk -F: '$2 == 0 {print $1}' \
    | head -n 1
}

main
